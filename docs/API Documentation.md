<!-- filepath: d:\OpiComTech\Projects\entraide-national\backend\API Documentation.md -->
# Entraide National API Documentation

*Generated by Copilot - Last Updated: May 7, 2025*

## Table of Contents

1. [Overview](#overview)
2. [Authentication](#authentication)
   - [Obtaining Tokens](#obtaining-tokens)
   - [Using Tokens](#using-tokens)
   - [Refreshing Tokens](#refreshing-tokens)
   - [Logging Out](#logging-out)
3. [API Endpoints](#api-endpoints)
   - [Authentication Endpoints](#authentication-endpoints)
   - [User Management](#user-management)
   - [Centers Management](#centers-management)
   - [Programs Management](#programs-management)
   - [Student Management](#student-management)
   - [Teacher Management](#teacher-management)
   - [Association Management](#association-management)
   - [Attendance Management](#attendance-management)
   - [Exam Management](#exam-management)
   - [Schedule Management](#schedule-management)
4. [Error Handling](#error-handling)
5. [Rate Limiting](#rate-limiting)
6. [Pagination](#pagination)
7. [Versioning](#versioning)
8. [Testing the API](#testing-the-api)
9. [Troubleshooting](#troubleshooting)
10. [Changelog](#changelog)

---

## Overview

The Entraide National API is a RESTful interface that provides access to all features of the Entraide National Management System. The API is built using Django REST Framework and follows REST principles.

All API responses are in JSON format. The API uses standard HTTP response codes, authentication with JSON Web Tokens (JWT), and versioning to ensure backward compatibility.

**Base URL**:
- Development: `http://localhost:8000/api/`
- Production: `https://api.entraide-national.ma/api/`

**Available API Documentation Interfaces**:
- Swagger UI: `/swagger/`
- ReDoc: `/redoc/`
- OpenAPI Schema: `/swagger.json` or `/swagger.yaml`

**Supported User Roles**:
- `admin`: Administrator
- `center_supervisor`: Center Supervisor
- `association_supervisor`: Association Supervisor
- `trainer`: Trainer
- `student`: Student

---

## Authentication

The API uses JSON Web Token (JWT) authentication. To access protected endpoints, you must include a valid access token in the Authorization header of your requests.

### Obtaining Tokens

To obtain authentication tokens, send a POST request to the token endpoint with your credentials.

**Endpoint**: `POST /api/token/`

**Request Format**:
```json
{
    "email": "your.email@example.com",
    "password": "yourpassword"
}
```

**Response Format**:
```json
{
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

The response contains two tokens:
- `access`: Used for authentication (valid for 24 hours)
- `refresh`: Used to obtain new access tokens (valid for 7 days)

### Using Tokens

Include the access token in the Authorization header of your requests:

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Refreshing Tokens

When the access token expires, use the refresh token to obtain a new one.

**Endpoint**: `POST /api/token/refresh/`

**Request Format**:
```json
{
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response Format**:
```json
{
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### Logging Out

To log out, blacklist the refresh token by sending a POST request to the logout endpoint.

**Endpoint**: `POST /api/accounts/users/logout/`

**Request Format**:
```json
{
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response Format**:
```json
{
    "detail": "Successfully logged out."
}
```

---

## API Endpoints

### Authentication Endpoints

| Endpoint | Method | Description | Authentication Required |
|----------|--------|-------------|------------------------|
| `/api/token/` | POST | Obtain JWT access and refresh tokens | No |
| `/api/token/refresh/` | POST | Refresh JWT access token | No |
| `/api/accounts/users/logout/` | POST | Blacklist refresh token (logout) | Yes |

#### Obtain Tokens

**Endpoint**: `POST /api/token/`

**Description**: Takes user credentials and returns JWT tokens for authentication.

**Request Body**:
- `email` (string, required): User's email address
- `password` (string, required): User's password

**Success Response** (200 OK):
```json
{
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Error Response** (401 Unauthorized):
```json
{
    "detail": "No active account found with the given credentials"
}
```

#### Refresh Token

**Endpoint**: `POST /api/token/refresh/`

**Description**: Use this endpoint to refresh your access token using a valid refresh token.

**Request Body**:
- `refresh` (string, required): Valid refresh token

**Success Response** (200 OK):
```json
{
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Error Response** (401 Unauthorized):
```json
{
    "detail": "Token is invalid or expired",
    "code": "token_not_valid"
}
```

### User Management

| Endpoint | Method | Description | Authentication Required | Allowed Roles |
|----------|--------|-------------|------------------------|--------------|
| `/api/accounts/users/` | GET | List all users (paginated) | Yes | Admin, Center Supervisor |
| `/api/accounts/users/` | POST | Create a new user | Yes | Admin, Center Supervisor |
| `/api/accounts/users/{id}/` | GET | Retrieve a specific user | Yes | Admin, Center Supervisor |
| `/api/accounts/users/{id}/` | PUT | Update a user (full update) | Yes | Admin, Center Supervisor |
| `/api/accounts/users/{id}/` | PATCH | Update a user (partial update) | Yes | Admin, Center Supervisor |
| `/api/accounts/users/{id}/` | DELETE | Delete a user | Yes | Admin, Center Supervisor |
| `/api/accounts/users/register/` | POST | Register a new user | Yes | Admin, Center Supervisor |
| `/api/accounts/users/me/` | GET | Retrieve current user's profile | Yes | Any authenticated user |
| `/api/accounts/users/me/` | PUT, PATCH | Update current user's profile | Yes | Any authenticated user |
| `/api/accounts/users/profile/` | GET | Alias for `/me/` endpoint | Yes | Any authenticated user |
| `/api/accounts/users/change_password/` | POST | Change the password for the current user | Yes | Any authenticated user |

#### List Users

**Endpoint**: `GET /api/accounts/users/`

**Description**: Returns a paginated list of all users.

**Query Parameters**:
- `page` (integer, optional): Page number for pagination
- `page_size` (integer, optional): Number of results per page

**Success Response** (200 OK):
```json
{
    "count": 50,
    "next": "http://localhost:8000/api/accounts/users/?page=2",
    "previous": null,
    "results": [
        {
            "id": 1,
            "email": "admin@example.com",
            "username": "admin",
            "first_name": "Admin",
            "last_name": "User",
            "role": "admin",
            "date_joined": "2023-05-06T10:00:00Z",
            "is_active": true
        },
        // ... more users
    ]
}
```

#### Register User

**Endpoint**: `POST /api/accounts/users/register/`

**Description**: Creates a new user account and returns authentication tokens.

**Request Body**:
- `email` (string, required): User's email address
- `first_name` (string, optional): User's first name
- `last_name` (string, optional): User's last name
- `password` (string, required): User's password
- `role` (string, required): User's role (admin, center_supervisor, association_supervisor, trainer, student)

**Success Response** (201 Created):
```json
{
    "user": {
        "id": 51,
        "email": "newuser@example.com",
        "username": "",
        "first_name": "New",
        "last_name": "User",
        "role": "student",
        "date_joined": "2023-05-07T11:30:00Z",
        "is_active": true
    },
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Error Response** (400 Bad Request):
```json
{
    "email": [
        "This field is required."
    ],
    "password": [
        "This field is required."
    ]
}
```

#### Retrieve User Profile

**Endpoint**: `GET /api/accounts/users/me/`

**Description**: Returns the current authenticated user's profile.

**Success Response** (200 OK):
```json
{
    "id": 1,
    "email": "user@example.com",
    "username": "user",
    "first_name": "John",
    "last_name": "Doe",
    "role": "student",
    "profile_picture": "https://res.cloudinary.com/example/image/upload/profile.jpg",
    "birth_date": "1995-05-15",
    "birth_city": "Casablanca",
    "CIN_id": "AB123456",
    "phone_number": "+212612345678",
    "address": "123 Example Street",
    "city": "Rabat",
    "date_joined": "2023-05-06T10:00:00Z",
    "is_active": true,
    "created_at": "2023-05-06T10:00:00Z",
    "updated_at": "2023-05-07T11:30:00Z"
}
```

#### Update User Profile

**Endpoint**: `PUT /api/accounts/users/me/`

**Description**: Updates the current authenticated user's profile.

**Request Body**:
Various profile fields that can be updated by the user.

**Success Response** (200 OK):
```json
{
    "id": 1,
    "email": "user@example.com",
    "username": "user",
    "first_name": "Updated",
    "last_name": "Name",
    "role": "student",
    "profile_picture": "https://res.cloudinary.com/example/image/upload/profile.jpg",
    "birth_date": "1995-05-15",
    "birth_city": "Casablanca",
    "CIN_id": "AB123456",
    "phone_number": "+212612345678",
    "address": "Updated Address",
    "city": "Marrakech",
    "date_joined": "2023-05-06T10:00:00Z",
    "is_active": true,
    "created_at": "2023-05-06T10:00:00Z",
    "updated_at": "2023-05-07T12:45:00Z"
}
```

#### Change Password

**Endpoint**: `POST /api/accounts/users/change_password/`

**Description**: Change password for the authenticated user.

**Request Body**:
- `old_password` (string, required): Current password
- `new_password` (string, required): New password

**Success Response** (200 OK):
```json
{
    "detail": "Password successfully changed."
}
```

**Error Response** (400 Bad Request):
```json
{
    "detail": "Old password is incorrect."
}
```

### Centers Management

The Centers Management module provides API endpoints for managing centers, rooms, equipment, and groups within centers. The base path for these endpoints is `/api/centers-app/`.

**Permissions**:
- **Admin**: Full CRUD access to Centers. Full CRUD access to Rooms, Equipment, and Groups.
- **Center Supervisor**: Read-only access to Centers they supervise (via filtering, direct listing of all centers is admin only). Full CRUD access to Rooms, Equipment, and Groups *within the centers they supervise*.
- **Authenticated Users**: Generally, read-only access if permitted by endpoint configuration (currently most list views are restricted to Admin/Supervisors).

**Filtering**: These endpoints support filtering using `django-filter`. For example, to filter rooms by type: `/api/centers-app/rooms/?type=classroom`.

**Nested Data**:
- Retrieving a specific `Center` will include a list of its `Rooms` and `Groups`.
- Retrieving a specific `Room` will include a list of its `Equipment`.

**Endpoints for Centers**

| Endpoint                                | Method        | Description                                                                                                | Allowed Roles         |
|-----------------------------------------|---------------|------------------------------------------------------------------------------------------------------------|-----------------------|
| `/api/centers-app/centers/`             | GET           | List all centers (paginated). Supports filtering, searching, and ordering.                                 | Admin                 |
|                                         |               | Filters: `city`, `affiliated_to`, `association` (ID), `association_name`, `is_active`, `is_verified`, `room_type`, `room_equipment_condition`. |                       |
|                                         |               | Search: `name`, `description`, `city`, `association__name`, `rooms__name`, `groups__name`.                          |                       |
| `/api/centers-app/centers/`             | POST          | Create a new center.                                                                                       | Admin                 |
| `/api/centers-app/centers/{id}/`        | GET           | Retrieve a specific center (includes nested rooms, groups).                                                | Admin                 |
| `/api/centers-app/centers/{id}/`        | PUT           | Update a center (full update).                                                                             | Admin                 |
| `/api/centers-app/centers/{id}/`        | PATCH         | Update a center (partial update).                                                                          | Admin                 |
| `/api/centers-app/centers/{id}/`        | DELETE        | Delete a center.                                                                                           | Admin                 |

**Endpoints for Rooms**

| Endpoint                             | Method        | Description                                                                                                   | Allowed Roles              |
|--------------------------------------|---------------|---------------------------------------------------------------------------------------------------------------|----------------------------|
| `/api/centers-app/rooms/`            | GET           | List all rooms (paginated). Admins see all; Supervisors see rooms in their centers. Supports filtering, searching, ordering. | Admin, Center Supervisor |
|                                      |               | Filters: `center__id`, `type`, `capacity`, `is_available`.                                                      |                            |
|                                      |               | Search: `name`, `description`.                                                                                |                            |
| `/api/centers-app/rooms/`            | POST          | Create a new room (must be associated with a center supervised by the user, or any center for Admin).        | Admin, Center Supervisor |
| `/api/centers-app/rooms/{id}/`       | GET           | Retrieve a specific room (includes nested equipment).                                                           | Admin, Center Supervisor |
| `/api/centers-app/rooms/{id}/`       | PUT           | Update a room (full update).                                                                                  | Admin, Center Supervisor |
| `/api/centers-app/rooms/{id}/`       | PATCH         | Update a room (partial update).                                                                               | Admin, Center Supervisor |
| `/api/centers-app/rooms/{id}/`       | DELETE        | Delete a room.                                                                                                | Admin, Center Supervisor |

**Endpoints for Equipment**

| Endpoint                                | Method        | Description                                                                                                        | Allowed Roles              |
|-----------------------------------------|---------------|--------------------------------------------------------------------------------------------------------------------|----------------------------|
| `/api/centers-app/equipment/`           | GET           | List all equipment (paginated). Admins see all; Supervisors see equipment in their centers. Supports filtering, searching, ordering. | Admin, Center Supervisor |
|                                         |               | Filters: `center__id`, `room__id`, `condition`, `quantity`.                                                          |                            |
|                                         |               | Search: `name`, `description`.                                                                                     |                            |
| `/api/centers-app/equipment/`           | POST          | Create new equipment (must be associated with a center supervised by the user, or any center for Admin).          | Admin, Center Supervisor |
| `/api/centers-app/equipment/{id}/`      | GET           | Retrieve specific equipment.                                                                                       | Admin, Center Supervisor |
| `/api/centers-app/equipment/{id}/`      | PUT           | Update equipment (full update).                                                                                    | Admin, Center Supervisor |
| `/api/centers-app/equipment/{id}/`      | PATCH         | Update equipment (partial update).                                                                                 | Admin, Center Supervisor |
| `/api/centers-app/equipment/{id}/`      | DELETE        | Delete equipment.                                                                                                  | Admin, Center Supervisor |

**Endpoints for Groups**

| Endpoint                              | Method        | Description                                                                                                     | Allowed Roles              |
|---------------------------------------|---------------|-----------------------------------------------------------------------------------------------------------------|----------------------------|
| `/api/centers-app/groups/`            | GET           | List all groups (paginated). Admins see all; Supervisors see groups in their centers. Supports filtering, searching, ordering. | Admin, Center Supervisor |
|                                       |               | Filters: `center__id`.                                                                                          |                            |
|                                       |               | Search: `name`, `description`.                                                                                  |                            |
| `/api/centers-app/groups/`            | POST          | Create a new group (must be associated with a center supervised by the user, or any center for Admin).           | Admin, Center Supervisor |
| `/api/centers-app/groups/{id}/`       | GET           | Retrieve a specific group.                                                                                      | Admin, Center Supervisor |
| `/api/centers-app/groups/{id}/`       | PUT           | Update a group (full update).                                                                                   | Admin, Center Supervisor |
| `/api/centers-app/groups/{id}/`       | PATCH         | Update a group (partial update).                                                                                | Admin, Center Supervisor |
| `/api/centers-app/groups/{id}/`       | DELETE        | Delete a group.                                                                                                 | Admin, Center Supervisor |

### Programs Management

The Programs Management module provides API endpoints for managing training programs, annual course distributions, weekly course plans, and specific training courses. The base path for these endpoints is `/api/programs/`.

**Permissions**:
- **Admin**: Full CRUD access to all program-related data.
- **Any Authenticated User**: Read-only access to program-related data (e.g., listing and viewing details).
  *(Specific endpoint permissions can be more granular based on backend implementation).*

**Nested Data**:
- Retrieving `AnnualCourseDistribution` includes the full `TrainingPrograme` object.
- Retrieving `WeeklyCoursePlan` includes the full `AnnualCourseDistribution` object (which in turn includes `TrainingPrograme`).
- Retrieving `TrainingCourse` includes the full `TrainingPrograme`, `Center`, and `User` (trainer) objects.

**Endpoints for Training Programs (`TrainingPrograme`)**

| Endpoint                                       | Method        | Description                               | Authentication Required | Allowed Roles          |
|------------------------------------------------|---------------|-------------------------------------------|-------------------------|------------------------|
| `/api/programs/trainingprogrames/`             | GET           | List all training programs (paginated).   | Yes                     | Any authenticated user |
| `/api/programs/trainingprogrames/`             | POST          | Create a new training program.            | Yes                     | Admin                  |
| `/api/programs/trainingprogrames/{id}/`        | GET           | Retrieve a specific training program.     | Yes                     | Any authenticated user |
| `/api/programs/trainingprogrames/{id}/`        | PUT           | Update a training program (full update).  | Yes                     | Admin                  |
| `/api/programs/trainingprogrames/{id}/`        | PATCH         | Update a training program (partial update).| Yes                     | Admin                  |
| `/api/programs/trainingprogrames/{id}/`        | DELETE        | Delete a training program.                | Yes                     | Admin                  |

**Example `TrainingPrograme` Object Structure (as seen in GET responses):**
```json
{
    "id": 1,
    "name": "Advanced Web Development",
    "description": "A comprehensive program covering modern web technologies.",
    "duration_years": 2,
    "logo": "https://res.cloudinary.com/yourcloud/image/upload/v12345/logos/program_logo.png", // Can be null
    "created_at": "2024-05-01T10:00:00Z",
    "updated_at": "2024-05-01T10:00:00Z"
}
```

**Fields for creating/updating (`POST`, `PUT`, `PATCH`) `TrainingPrograme`:**
- `name` (string, required): Name of the training program.
- `description` (string, required): Detailed description of the program.
- `duration_years` (integer, required): Duration of the program in years.
- `logo` (image file or URL, optional): Logo image for the program. If providing a file, use `multipart/form-data`.

**Endpoints for Annual Course Distributions (`AnnualCourseDistribution`)**

| Endpoint                                                    | Method        | Description                                           | Authentication Required | Allowed Roles          |
|-------------------------------------------------------------|---------------|-------------------------------------------------------|-------------------------|------------------------|
| `/api/programs/annualcoursedistributions/`                  | GET           | List all annual course distributions (paginated).   | Yes                     | Any authenticated user |
| `/api/programs/annualcoursedistributions/`                  | POST          | Create a new annual course distribution.            | Yes                     | Admin                  |
| `/api/programs/annualcoursedistributions/{id}/`             | GET           | Retrieve a specific annual course distribution.     | Yes                     | Any authenticated user |
| `/api/programs/annualcoursedistributions/{id}/`             | PUT           | Update an annual course distribution (full update).  | Yes                     | Admin                  |
| `/api/programs/annualcoursedistributions/{id}/`             | PATCH         | Update an annual course distribution (partial update).| Yes                     | Admin                  |
| `/api/programs/annualcoursedistributions/{id}/`             | DELETE        | Delete an annual course distribution.                | Yes                     | Admin                  |

**Endpoints for Weekly Course Plans (`WeeklyCoursePlan`)**

| Endpoint                                                | Method        | Description                                       | Authentication Required | Allowed Roles          |
|---------------------------------------------------------|---------------|---------------------------------------------------|-------------------------|------------------------|
| `/api/programs/weeklycourseplans/`                      | GET           | List all weekly course plans (paginated).       | Yes                     | Any authenticated user |
| `/api/programs/weeklycourseplans/`                      | POST          | Create a new weekly course plan.                | Yes                     | Admin                  |
| `/api/programs/weeklycourseplans/{id}/`                 | GET           | Retrieve a specific weekly course plan.         | Yes                     | Any authenticated user |
| `/api/programs/weeklycourseplans/{id}/`                 | PUT           | Update a weekly course plan (full update).      | Yes                     | Admin                  |
| `/api/programs/weeklycourseplans/{id}/`                 | PATCH         | Update a weekly course plan (partial update).   | Yes                     | Admin                  |
| `/api/programs/weeklycourseplans/{id}/`                 | DELETE        | Delete a weekly course plan.                    | Yes                     | Admin                  |

**Endpoints for Training Courses (`TrainingCourse`)**

| Endpoint                                            | Method        | Description                                   | Authentication Required | Allowed Roles          |
|-----------------------------------------------------|---------------|-----------------------------------------------|-------------------------|------------------------|
| `/api/programs/trainingcourses/`                    | GET           | List all training courses (paginated).        | Yes                     | Any authenticated user |
| `/api/programs/trainingcourses/`                    | POST          | Create a new training course.                 | Yes                     | Admin                  |
| `/api/programs/trainingcourses/{id}/`               | GET           | Retrieve a specific training course.          | Yes                     | Any authenticated user |
| `/api/programs/trainingcourses/{id}/`               | PUT           | Update a training course (full update).       | Yes                     | Admin                  |
| `/api/programs/trainingcourses/{id}/`               | PATCH         | Update a training course (partial update).    | Yes                     | Admin                  |
| `/api/programs/trainingcourses/{id}/`               | DELETE        | Delete a training course.                     | Yes                     | Admin                  |

### Student Management

The base path for these endpoints is `/api/students/`. These endpoints provide CRUD operations for managing students.

**Permissions**:
- **Admin, Center Supervisor**: Full CRUD access to student records. Can view all students.
- **Authenticated Users (e.g., Students, Trainers)**: Can view their own student profile (if one exists). Cannot create, update, or delete other students.

**Filtering & Pagination**:
- Standard pagination is supported for list views.
- Filtering capabilities (e.g., by center, program) can be added via `django-filter` integration with the `StudentViewSet` if needed in the future.

| Endpoint                 | Method        | Description                                                                                                | Authentication Required | Allowed Roles                                     |
|--------------------------|---------------|------------------------------------------------------------------------------------------------------------|-------------------------|---------------------------------------------------|
| `/api/students/`         | GET           | List students. Admins/Supervisors see all; others see their own profile. (Paginated)                        | Yes                     | Admin, Center Supervisor, Any authenticated user  |
| `/api/students/`         | POST          | Create a new student. Automatically creates an associated User account. Requires `first_name` and `last_name`. | Yes                     | Admin, Center Supervisor                          |
| `/api/students/{id}/`    | GET           | Retrieve a specific student. Admins/Supervisors see any; others can only see their own.                      | Yes                     | Admin, Center Supervisor, Any authenticated user  |
| `/api/students/{id}/`    | PUT           | Update a student (full update).                                                                            | Yes                     | Admin, Center Supervisor                          |
| `/api/students/{id}/`    | PATCH         | Update a student (partial update).                                                                         | Yes                     | Admin, Center Supervisor                          |
| `/api/students/{id}/`    | DELETE        | Delete a student. (Associated User account is also deleted due to CASCADE).                                | Yes                     | Admin, Center Supervisor                          |

#### Create a New Student

**Endpoint**: `POST /api/students/`

**Description**: Creates a new student profile. This process automatically creates an associated `User` account with the `student` role. The user's email is generated based on their first and last name (e.g., `firstname.lastname@entraide-larache.com`), and a default password is set.
**Important**: The default password set during account creation is insecure and intended for immediate change by the user or an administrator. Implement a secure password reset or initial setup flow.

**Authentication**: Required (Bearer Token)

**Allowed Roles**: `Admin`, `Center Supervisor`

**Request Body Fields**:

*   `first_name` (string, **required**): Student's first name. Used for User account creation.
*   `last_name` (string, **required**): Student's last name. Used for User account creation.
*   `exam_id` (string, **required**, unique): Unique examination ID for the student.
*   `center` (integer, **required**): ID of the `Center` the student belongs to.
*   `program` (integer, **required**): ID of the `TrainingPrograme` the student is enrolled in.
*   `academic_year` (string, **required**): Academic year (e.g., "2023-2024").
*   `joining_date` (date string, **required**, format: `YYYY-MM-DD`): Date the student joined.
*   `center_code` (string, optional): Specific code related to the center, if applicable.
*   `training_course` (integer, optional): ID of the specific `TrainingCourse` if applicable.
*   `group` (integer, optional): ID of the `Group` the student is assigned to, if applicable.

**Example Request Body**:
```json
{
    "first_name": "Fatima",
    "last_name": "Zahra",
    "exam_id": "STU789012",
    "center": 1,
    "program": 1,
    "academic_year": "2024-2025",
    "joining_date": "2024-09-01",
    "center_code": "C001-S2"
}
```

**Success Response (201 Created)**:
Returns the full student object, including information about the automatically created user.
```json
{
    "id": 123,
    "exam_id": "STU789012",
    "center_code": "C001-S2",
    "center": 1, // Or a string representation if StringRelatedField is used in the GET serializer
    "program": 1, // Or a string representation
    "academic_year": "2024-2025",
    "joining_date": "2024-09-01",
    "training_course": null, // Or relevant ID/string
    "group": null, // Or relevant ID/string
    "user_info": "Fatima Zahra - (Student)", // String representation from User model
    "created_at": "2024-07-29T10:30:00Z",
    "updated_at": "2024-07-29T10:30:00Z"
}
```

**Error Responses**:
-   `400 Bad Request`: If validation fails (e.g., missing required fields like `first_name`, `last_name`, `exam_id`, or invalid data format). The response body will contain details about the errors.
    ```json
    {
        "first_name": ["This field is required."],
        "exam_id": ["student with this exam id already exists."]
        // ... other errors
    }
    ```
    ```json
    {
        "user_creation_error": "Failed to create user account: [Details from User model/manager validation]"
    }
    ```
-   `401 Unauthorized`: If the request lacks valid authentication credentials.
-   `403 Forbidden`: If the authenticated user does not have the required role (`Admin` or `Center Supervisor`).

### Teacher Management

The following endpoints will be implemented as part of the next development phase:

| Endpoint | Method | Description | Authentication Required | Allowed Roles |
|----------|--------|-------------|------------------------|--------------|
| `/api/teachers/` | GET | List all teachers (paginated) | Yes | Admin, Center Supervisor, Association Supervisor |
| `/api/teachers/` | POST | Create a new teacher | Yes | Admin, Center Supervisor |
| `/api/teachers/{id}/` | GET | Retrieve a specific teacher | Yes | Admin, Center Supervisor, Association Supervisor |
| `/api/teachers/{id}/` | PUT | Update a teacher (full update) | Yes | Admin, Center Supervisor |
| `/api/teachers/{id}/` | PATCH | Update a teacher (partial update) | Yes | Admin, Center Supervisor |
| `/api/teachers/{id}/` | DELETE | Delete a teacher | Yes | Admin |
| `/api/teachers/{id}/courses/` | GET | List courses taught by a teacher | Yes | Admin, Center Supervisor, Trainer |

### Association Management

The base path for these endpoints is `/api/associations/`. These endpoints provide CRUD operations for managing associations.

**Permissions**:
- **Admin**: Full CRUD access to all associations.
- **Association Supervisor**: Future implementation may restrict write access to associations they supervise. (Currently Admin for write ops).
- **Any Authenticated User**: Read-only access to list and retrieve associations.

**Filtering & Pagination**:
- Standard pagination is supported for list views.
- Filtering capabilities (e.g., by name, city, supervisor) can be added via `django-filter` integration with the `AssociationViewSet`.

| Endpoint                  | Method | Description                                   | Authentication Required | Allowed Roles          |
|---------------------------|--------|-----------------------------------------------|------------------------|------------------------|
| `/api/associations/`      | GET    | List all associations (paginated).            | Yes                    | Any authenticated user |
| `/api/associations/`      | POST   | Create a new association.                     | Yes                    | Admin                  |
| `/api/associations/{id}/` | GET    | Retrieve a specific association.              | Yes                    | Any authenticated user |
| `/api/associations/{id}/` | PUT    | Update an association (full update).          | Yes                    | Admin                  |
| `/api/associations/{id}/` | PATCH  | Update an association (partial update).       | Yes                    | Admin                  |
| `/api/associations/{id}/` | DELETE | Delete an association.                        | Yes                    | Admin                  |

#### Create a New Association

**Endpoint**: `POST /api/associations/`

**Description**: Creates a new association. This endpoint expects `multipart/form-data` if including a file (e.g., `logo`), otherwise `application/json`.

**Authentication**: Required (Bearer Token)

**Allowed Roles**: `Admin`

**Request Body Fields**:

*   `name` (string, **required**): Name of the association.
*   `description` (string, **required**): A detailed description of the association.
*   `supervisor` (integer, **required**): The ID of the user designated as the supervisor for this association.
*   `logo` (file, optional): An image file for the association's logo.
*   `phone_number` (string, optional): Contact phone number (e.g., "+1-555-123-4567").
*   `email` (string, optional, format: email): Contact email address.
*   `address` (string, optional): Physical street address.
*   `city` (string, optional): City where the association is based.
*   `maps_link` (string, optional, format: url): A URL to the association's location on a map service (e.g., Google Maps).
*   `website` (string, optional, format: url): The association's official website URL.
*   `facebook_link` (string, optional, format: url): URL to the association's Facebook page.
*   `instagram_link` (string, optional, format: url): URL to the association's Instagram profile.
*   `twitter_link` (string, optional, format: url): URL to the association's Twitter profile.
*   `contract_start_date` (date string, optional, format: `YYYY-MM-DD`): The start date of any relevant contract.
*   `contract_end_date` (date string, optional, format: `YYYY-MM-DD`): The end date of any relevant contract.
*   `registration_number` (string, optional): The official registration number of the association.
    *(Note: While optional in the request, the model defines this as unique if provided.)*

*(Fields like `is_active`, `is_verified` default to `true` on the backend if not provided.)*

**Success Response (201 Created)**:
Returns the full association object upon successful creation.
```json
{
    "id": 1,
    "name": "Al Amal Association",
    "description": "Supporting local youth programs.",
    "logo": "https://res.cloudinary.com/yourcloud/image/upload/v12345/logos/al_amal_logo.png",
    "phone_number": "+212600000000",
    "email": "contact@alamal.ma",
    "address": "123 Hope Street",
    "city": "Rabat",
    "maps_link": "https://maps.google.com/?q=Al+Amal+Association+Rabat",
    "website": "https://alamal.ma",
    "facebook_link": "https://facebook.com/alamalrabat",
    "instagram_link": "https://instagram.com/alamalrabat",
    "twitter_link": null,
    "supervisor": 5,
    "contract_start_date": "2024-01-01",
    "contract_end_date": "2025-12-31",
    "registration_number": "ASSOC-RBT-001",
    "is_active": true,
    "is_verified": true,
    "created_at": "2024-05-08T10:30:00Z",
    "updated_at": "2024-05-08T10:30:00Z"
}
```

**Error Responses**:
-   `400 Bad Request`: If validation fails (e.g., missing required fields, invalid data format). The response body will contain details about the errors.
    ```json
    {
        "name": ["This field is required."],
        "description": ["This field is required."],
        "supervisor": ["This field is required."]
    }
    ```
-   `401 Unauthorized`: If the request lacks valid authentication credentials.
-   `403 Forbidden`: If the authenticated user does not have the `Admin` role.

### Attendance Management

The following endpoints will be implemented as part of the next development phase:

| Endpoint | Method | Description | Authentication Required | Allowed Roles |
|----------|--------|-------------|------------------------|--------------|
| `/api/attendance/sessions/` | GET | List attendance sessions (paginated) | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/sessions/` | POST | Create a new attendance session | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/sessions/{id}/` | GET | Retrieve a specific attendance session | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/sessions/{id}/` | PUT | Update an attendance session | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/sessions/{id}/` | DELETE | Delete an attendance session | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/records/` | GET | List attendance records (paginated) | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/records/` | POST | Create a new attendance record | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/records/bulk_create/` | POST | Create multiple attendance records | Yes | Admin, Center Supervisor, Trainer |
| `/api/attendance/records/my-attendance/` | GET | Get attendance records for current student | Yes | Student |
| `/api/attendance/records/by-enrollment/{enrollment_id}/` | GET | Get attendance records for an enrollment | Yes | Admin, Center Supervisor, Trainer, Student |

### Exam Management

The following endpoints will be implemented as part of the next development phase:

| Endpoint | Method | Description | Authentication Required | Allowed Roles |
|----------|--------|-------------|------------------------|--------------|
| `/api/exams/` | GET | List exams (paginated) | Yes | Admin, Center Supervisor, Trainer |
| `/api/exams/` | POST | Create a new exam | Yes | Admin, Trainer |
| `/api/exams/{id}/` | GET | Retrieve a specific exam | Yes | Admin, Center Supervisor, Trainer, Student |
| `/api/exams/{id}/` | PUT | Update an exam | Yes | Admin, Trainer |
| `/api/exams/{id}/` | DELETE | Delete an exam | Yes | Admin, Trainer |
| `/api/exams/questions/` | GET | List exam questions | Yes | Admin, Trainer |
| `/api/exams/questions/` | POST | Create a new exam question | Yes | Admin, Trainer |
| `/api/exams/results/` | GET | List exam results (paginated) | Yes | Admin, Center Supervisor, Trainer |
| `/api/exams/results/my-results/` | GET | Get exam results for current student | Yes | Student |

### Schedule Management

The following endpoints will be implemented as part of the next development phase:

| Endpoint | Method | Description | Authentication Required | Allowed Roles |
|----------|--------|-------------|------------------------|--------------|
| `/api/schedule/` | GET | List schedules (paginated) | Yes | Any authenticated user |
| `/api/schedule/` | POST | Create a new schedule | Yes | Admin, Center Supervisor |
| `/api/schedule/{id}/` | GET | Retrieve a specific schedule | Yes | Any authenticated user |
| `/api/schedule/{id}/` | PUT | Update a schedule | Yes | Admin, Center Supervisor |
| `/api/schedule/{id}/` | DELETE | Delete a schedule | Yes | Admin, Center Supervisor |
| `/api/schedule/my-schedule/` | GET | Get schedule for current user | Yes | Any authenticated user |

---

## Error Handling

The API uses standard HTTP status codes to indicate the success or failure of a request:

- `200 OK`: The request was successful
- `201 Created`: A new resource was successfully created
- `204 No Content`: The request was successful but there is no content to return
- `400 Bad Request`: The request was malformed or invalid
- `401 Unauthorized`: Authentication failed or not provided
- `403 Forbidden`: The authenticated user doesn't have permission to access the resource
- `404 Not Found`: The requested resource was not found
- `405 Method Not Allowed`: The HTTP method is not allowed for the requested endpoint
- `500 Internal Server Error`: An error occurred on the server

All error responses include a detail message that provides more information about the error:

```json
{
    "detail": "Error message describing what went wrong"
}
```

Validation errors return a 400 Bad Request status code with field-specific error messages:

```json
{
    "field_name": [
        "Error message for this field"
    ],
    "another_field": [
        "Error message for another field"
    ]
}
```

---

## Rate Limiting

To ensure fair usage and protect against abuse, API requests are subject to rate limiting. The current rate limits are:

- Anonymous requests: 60 requests per hour
- Authenticated requests: 1000 requests per hour

When a rate limit is exceeded, the API returns a 429 Too Many Requests status code with headers indicating the rate limit and when it will reset:

```
HTTP/1.1 429 Too Many Requests
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1620414000
```

The `X-RateLimit-Reset` header contains a Unix timestamp indicating when the rate limit will reset.

---

## Pagination

List endpoints return paginated results to ensure optimal performance. The default page size is 20 items, but you can customize this with the `page_size` query parameter (up to a maximum of 100).

Pagination information is included in the response:

```json
{
    "count": 100,
    "next": "http://localhost:8000/api/endpoint/?page=2",
    "previous": null,
    "results": [
        // List of items
    ]
}
```

Use the `next` and `previous` URLs to navigate through the pages.

---

## Versioning

The API uses URL-based versioning to ensure backward compatibility. The current version is v1, which is the default if no version is specified.

To explicitly specify a version, include it in the Accept header:

```
Accept: application/json; version=1.0
```

---

## Testing the API

### Using Swagger UI

You can test all API endpoints through the Swagger UI interface:

1. Navigate to `/swagger/` in your browser
2. Click on the "Authorize" button and enter your JWT token
3. Explore the available endpoints and test them directly from the interface

### Using curl

Example of obtaining a token using curl:

```bash
curl -X POST "http://localhost:8000/api/token/" \
     -H "Content-Type: application/json" \
     -d '{"email": "user@example.com", "password": "password"}'
```

Example of using the token to access a protected endpoint:

```bash
curl -X GET "http://localhost:8000/api/accounts/users/me/" \
     -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

## Troubleshooting

### Common Issues

1. **Authentication Issues**
   - Ensure you're including the token in the correct format: `Authorization: Bearer <token>`
   - Verify that your token hasn't expired
   - If expired, use the refresh token to obtain a new access token

2. **Permission Issues**
   - Verify that your user account has the necessary permissions for the action
   - Check that you're using the correct HTTP method for the endpoint

3. **Validation Errors**
   - Make sure all required fields are included in your request
   - Check that field values meet the validation requirements

### Getting Help

If you encounter issues or have questions about the API, please contact:

- Technical Support: support@entraide-national.ma
- API Development Team: api@entraide-national.ma

---

## Changelog

### Version 1.0 (May 2025)
- Initial API release with authentication and user management endpoints
- Documentation for upcoming endpoints in the next development phases

---

*This documentation will be updated as new endpoints are implemented.*